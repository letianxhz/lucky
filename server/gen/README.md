# 生成代码目录

这个目录用于存放所有自动生成的代码文件。

## 目录结构

```
gen/
├── db/          # Protocol Buffers 生成的 Go 代码（数据库相关）
│   ├── *.pb.go       # proto 生成的代码
│   └── *_xdb.pb.go   # xdb 扩展生成的代码
├── msg/         # 协议消息代码（从 pkg/protocol 生成）
│   └── *.pb.go       # protocol 生成的 Go 代码
├── sql/         # 数据库脚本
│   └── *.sql         # SQL 建表脚本
└── config/      # 配置代码
    └── db_config.go  # 数据库配置代码
```

## 生成脚本

所有生成脚本位于 `server/` 目录下：

- **`gen_all.sh`** - 生成所有代码（pb、msg、db、config）
- **`gen_msg.sh`** - 仅生成 msg 代码
- **`gen_db.sh`** - 仅生成 db 脚本

## 使用方法

### 生成所有代码

```bash
cd /path/to/lucky/server
./gen_all.sh
```

### 仅生成特定类型代码

```bash
# 仅生成 msg 代码
./gen_msg.sh

# 仅生成 db 脚本
./gen_db.sh
```

## 源文件位置

- **数据库定义**：`db/proto/` - 数据库表结构定义的 `.proto` 文件
- **协议定义**：`pkg/protocol/` - 协议消息定义的 `.proto` 文件

## 生成流程

1. **生成 DB 代码**：
   - 从 `db/proto/` 目录读取数据库定义的 `.proto` 文件
   - 使用 `protoc` 和 `protoc-gen-xdb` 生成到 `gen/db/`
   - 包名：`package db`
   - 文件：`*.pb.go`（标准 proto 代码）和 `*_xdb.pb.go`（xdb 扩展代码）

2. **生成 MSG 代码**：
   - 从 `pkg/protocol/` 目录读取协议定义的 `.proto` 文件
   - 使用 `protoc` 和 `protoc-gen-go` 生成到 `gen/msg/`
   - 包名：`package msg`
   - 文件：`*.pb.go`（协议消息代码）

3. **生成 SQL 脚本**：
   - 从 `db/proto/` 的 proto 文件生成 SQL 建表脚本到 `gen/sql/`
   - 文件：`*.sql`

4. **生成 Config 代码**：
   - 生成数据库配置代码到 `gen/config/`
   - 文件：`db_config.go`

## 注意事项

- 所有生成的文件都标记为 `// Code generated by ... DO NOT EDIT.`
- 不要手动修改生成的文件
- 修改源 `.proto` 文件后需要重新运行生成脚本

